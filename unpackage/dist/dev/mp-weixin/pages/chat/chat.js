(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/chat/chat"],{100:function(e,t,n){"use strict";var o;n.r(t),n.d(t,"render",(function(){return r})),n.d(t,"staticRenderFns",(function(){return a})),n.d(t,"recyclableRender",(function(){return c})),n.d(t,"components",(function(){return o}));try{o={uniTransition:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-transition/components/uni-transition/uni-transition")]).then(n.bind(null,209))}}}catch(s){if(-1===s.message.indexOf("Cannot find module")||-1===s.message.indexOf(".vue"))throw s;console.error(s.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var e=this,t=e.$createElement;e._self._c},c=!1,a=[];r._withStripped=!0},101:function(e,t,n){"use strict";n.r(t);var o=n(102),r=n.n(o);for(var c in o)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(c);t["default"]=r.a},102:function(e,t,n){"use strict";(function(e,o){var r=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=r(n(103)),a=r(n(11)),s=r(n(105));function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){(0,a.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l={name:"TemplateLoading",components:{},data:function(){return{chat:[],openData:[],problem:"",answer:"",currentAnswerIndex:-1,platform:"h5",webSocketClient:null,upOption:{use:!1,noMoreSize:0},downOption:{auto:!1},scrollTop:9999999999,left:"auto",right:40,bottom:300,width:64,height:64,iconSize:48,backgroundColor:"#01BEFF",fontColor:"#FFFFFF",icon:"open",animationType:"around",showMask:!0,btnList:[{icon:"link",text:"链接",bgColor:"#E72F8C"},{icon:"clear",text:"清屏",textSize:32,bgColor:"#FF7043"},{icon:"share-triangle",text:"分享",iconSize:32,iconColor:"#AAAAAA",bgColor:"#24F083"}],statusBarHeight:20}},props:{askInfo:String,typeName:String},watch:{askInfo:function(e,t){this.askInfo=e},typeName:function(e,t){this.typeName=e,this.chat=[],this.getChat()}},onLoad:function(){this.statusBarHeight=e.getSystemInfoSync().statusBarHeight+"px",e.getStorageSync("gptType")&&(e.setNavigationBarTitle({title:e.getStorageSync("gptType")[0]}),this.chat.push({type:"text",problem:e.getStorageSync("gptType")[0],answer:this.askInfo}));var t=e.getSystemInfoSync(),n="devtools"===t.platform||"mp-weixin"===t.platform,o="android"===t.platform||"ios"===t.platform,r="undefined"!==typeof window&&"undefined"!==typeof document;n?this.platform="isWechat":o?this.platform="isApp":r&&(this.platform="isH5")},beforeDestroy:function(){},methods:{clickFabItem:function(e){switch(e.index){case 0:this.$tn.message.toast("暂未开放");break;case 1:this.openData=[],this.chat=[],this.getChat(),this.$tn.message.toast("已清屏");break;case 2:this.$tn.message.toast("暂未开放");break}},scroll:function(e){},getChat:function(){this.chat.push({type:"text",problem:"",answer:this.askInfo})},copy:function(t){e.setClipboardData({data:this.answer||t,success:function(){e.showToast({title:"复制成功",icon:"none"})}})},isJSON:function(e){try{return JSON.parse(e),!0}catch(t){return!1}},getContentFromData:function(e){try{if(!this.isJSON(e))return"";var t=JSON.parse(e);return t&&t.choices&&t.choices[0]&&t.choices[0].delta&&t.choices[0].delta.content?t.choices[0].delta.content:""}catch(n){return console.error("Error extracting content from JSON string:",n),""}},connectWebSocket:function(e){var t=this;return(0,s.default)(c.default.mark((function n(){return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.webSocketClient=o.connectSocket({url:e,timeout:12e4,header:{"content-type":"application/json"},success:function(){console.log("WebSocket connection established.")},fail:function(e){console.error("WebSocket connection failed:",e)}});case 1:case"end":return n.stop()}}),n)})))()},closeWebSocket:function(){this.webSocketClient&&(this.webSocketClient.close(),console.log("WebSocket connection closed."))},requestWebSocketServer:function(e){var t=this;return(0,s.default)(c.default.mark((function n(){var r,a,i,l,p,f;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e&&e.url&&e.apiopen&&e.apiopen.key&&e.apiopen.prompt&&e.apiopen.typeName){n.next=3;break}return console.error("Invalid response or missing parameters."),n.abrupt("return");case 3:r=e.apiopen.key,a=e.apiopen.prompt,i=e.apiopen.typeName,l="isWechat"===t.platform,p=e.url,f=JSON.stringify({key:r,prompt:a,typeName:i}),console.log("组织的data参数：>>>>",f),l?(t.connectWebSocket(p),o.onError((function(e){console.error("General error:",e)})),o.onSocketOpen((0,s.default)(c.default.mark((function e(){return c.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.webSocketClient.readyState!==t.webSocketClient.OPEN){e.next=11;break}return e.prev=1,e.next=4,t.webSocketClient.send({data:f});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](1),console.error("Error sending data to WebSocket server:",e.t0);case 9:e.next=12;break;case 11:console.error("WebSocket connection is not open.");case 12:case"end":return e.stop()}}),e,null,[[1,6]])})))),o.onSocketMessage((function(e){"[DONE]"===e.data&&t.webSocketClient.close();var n=t.getContentFromData(e.data);if(n&&-1!==t.currentAnswerIndex){var o=t.currentAnswerIndex;t.$set(t.chat,o,u(u({},t.chat[o]),{},{type:"text",answer:t.chat[o].answer+n}))}})),o.onSocketClose((function(e){console.log("WebSocket connection closed. Code:",e.code,"Reason:",e.reason)})),o.onSocketError((function(e){console.error("WebSocket error:",e)}))):(t.webSocketClient=new WebSocket(p),t.webSocketClient.onopen=(0,s.default)(c.default.mark((function e(){return c.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.webSocketClient.send(f);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e["catch"](0),console.error("Error sending data to WebSocket server:",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),t.webSocketClient.onmessage=function(e){"[DONE]"===e.data&&t.webSocketClient.close();var n=t.getContentFromData(e.data);if(n&&-1!==t.currentAnswerIndex){var o=t.currentAnswerIndex;t.$set(t.chat,o,u(u({},t.chat[o]),{},{type:"text",answer:t.chat[o].answer+n}))}},t.webSocketClient.onclose=function(){console.log("WebSocket connection closed.")},t.webSocketClient.onerror=function(e){console.error("WebSocket error:",e)});case 11:case"end":return n.stop()}}),n)})))()},getAnswer:function(){var t=this;return(0,s.default)(c.default.mark((function n(){var o;return c.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.getStorageSync("user"),t.currentAnswerIndex=t.chat.length,t.problem){n.next=5;break}return e.showToast({title:"你还没有输入问题呢！",icon:"none"}),n.abrupt("return");case 5:t.chat.push({type:"text",problem:t.problem,answer:""}),t.openData.push({role:"user",content:t.problem}),o="",t.chat.forEach((function(e){o+="\nQ: ".concat(e.problem,"\n"),o+="A: ".concat(e.answer,"。 <|endoftext|>\n")})),o+="Q: ".concat(t.problem,'  + "\nA: '),"painting"==t.typeName&&(o=t.problem),setTimeout((function(){t.scrollTop=t.scrollTop+1}),100),t.openData.push({role:"user",content:t.problem}),t.$http.openai({type:"chat",typeName:t.typeName,platform:t.platform,data:o}).then((function(e){console.log(e),0==e.code?"painting"==t.typeName?t.$set(t.chat,currentAnswerIndex,u(u({},t.chat[currentAnswerIndex]),{},{answer:e.text,type:"image"})):t.requestWebSocketServer(e):(t.openData.splice(t.openData.length-1,1),t.$set(t.chat,currentAnswerIndex,u(u({},t.chat[currentAnswerIndex]),{},{answer:"error"})),t.$nextTick((function(){t.scrollTop=999999999})))})),t.problem="";case 15:case"end":return n.stop()}}),n)})))()}}};t.default=l}).call(this,n(2)["default"],n(1)["default"])},106:function(e,t,n){"use strict";n.r(t);var o=n(107),r=n.n(o);for(var c in o)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(c);t["default"]=r.a},107:function(e,t,n){},97:function(e,t,n){"use strict";(function(e,t){var o=n(4);n(26);o(n(25));var r=o(n(98));e.__webpack_require_UNI_MP_PLUGIN__=n,t(r.default)}).call(this,n(1)["default"],n(2)["createPage"])},98:function(e,t,n){"use strict";n.r(t);var o=n(99),r=n(101);for(var c in r)["default"].indexOf(c)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(c);n(106);var a,s=n(32),i=Object(s["default"])(r["default"],o["render"],o["staticRenderFns"],!1,null,"bf16e7f4",null,!1,o["components"],a);i.options.__file="pages/chat/chat.vue",t["default"]=i.exports},99:function(e,t,n){"use strict";n.r(t);var o=n(100);n.d(t,"render",(function(){return o["render"]})),n.d(t,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(t,"components",(function(){return o["components"]}))}},[[97,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/chat/chat.js.map